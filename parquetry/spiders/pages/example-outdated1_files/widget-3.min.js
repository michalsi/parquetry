CSV.COLUMN_SEPARATOR=";";var rata=function(a,t,e,n,o,r){var i=12*t,s=a*(1+e)+n,l=1+(o+r)/12,d=s*Math.pow(l,i)*((l-1)/(Math.pow(l,i)-1));return d},kwotaKredytu=function(a,t,e,n,o,r){var i=12*t,s=1+(o+r)/12,l=(a/(Math.pow(s,i)*((s-1)/(Math.pow(s,i)-1)))-n)/(1+e);return l};$(function(){"use strict";var a,t,e=getQueryParams(location.search);e.wnioskowana_kwota?t=parseInt(e.wnioskowana_kwota):e.cena?(a=parseInt(e.cena),t=Math.min(a,3e6)):(a=5e5,t=a);var n,o,r,i,s,l,d,p,c,u,m=25e3,w=t,f=parseInt(e.lata_splaty)||30,k=10,h=30,y=[];e.wnioskowana_kwota||e.cena||(m=25e3,w=3e6);var g=function(){if($("#kwota-kredytu").text(formatPrice(t,!0)),$("#odsetki").text(formatPrice(parseInt(c))),$("#pozostale").text(formatPrice(parseInt(s))),$("#calkowity-koszt").text(formatPrice(parseInt(p))),"undefined"!=typeof u){var a=(c+s)/(t+c+s)*360;u.series[1].update({data:[{name:"wnioskowana kwota kredytu",y:t,color:"#62b14a"}],startAngle:a}),console.log(a),s>0?(u.series[2].update({data:[{name:"całkowity koszt kredytu",y:c+s,color:"#5e86b5"}],endAngle:a}),u.series[3].update({data:[{name:"odsetki",y:c,color:"#f8d635"},{name:"prowizja",y:s,color:"#808184"}],endAngle:a})):u.series[2].update({data:[{name:"odsetki",y:parseInt(c),color:"#f8d635"}],endAngle:a})}},v=function(){s=t*r+i,l=rata(t,f,r,i,n,o),d=12*f*l,c=d-t-s,p=c+s},b=function(){for(var a=[],e=k;e<=h;e++){var s=[],l=parseInt(rata(t,e,r,i,n,o));s.push(e),s.push(l),a.push(s)}y=a};$.ajax("csv/kalkulator/kalkulator.csv").pipe(CSV.parse).done(function(a){n=a[1][1].slice(0,-1).replace(",",".")/100,o=a[2][1].slice(0,-1).replace(",",".")/100,r=a[3][1].slice(0,-1).replace(",",".")/100,i=a[4][1],v();var l=$(".calculator-controls .row"),d=[];l.each(function(a){var s=$(this),l=s.find(".slider"),p=s.find(".value");d[a]=l[0];var c={animate:!1};s.is(".rata")?(c.start=rata(t,f,r,i,n,o),c.range={min:rata(m,h,r,i,n,o),max:rata(w,k,r,i,n,o)}):s.is(".kwota")?(c.start=t,c.range={min:m,max:w}):s.is(".okres")&&(c.start=f,c.range={min:k,max:h},c.step=1),noUiSlider.create(l[0],c),l[0].noUiSlider.on("update",function(a,n){var o=parseInt(a[0]),r=o;s.is(".rata")?(r=formatPrice(o)+" zł",g(),$('input[name="rata"]').val(o),e.internal&&window.parent.$('input[name="rata"]').val(o)):s.is(".kwota")?(t=o,v(),r=formatPrice(o)+" zł",$('input[name="amount"]').val(o),$('input[name="wnioskowana_kwota"]').val(o),e.internal&&(window.parent.$('input[name="amount"]').val(o),window.parent.$('input[name="wnioskowana_kwota"]').val(o)),b()):s.is(".okres")&&(f=o,v(),r=o+" lat",$('input[name="period"]').val(o),$('input[name="lata_splaty"]').val(o),e.internal&&(window.parent.$('input[name="period"]').val(o),window.parent.$('input[name="lata_splaty"]').val(o))),p.text(r)}),l[0].noUiSlider.on("slide",function(a,e){var l=parseInt(a[0]),d=l;if(s.is(".rata")){var p=y[y.length-1][1],c=y[0][1];if(l<p&&this.set(p),l>c&&this.set(c),l<=c){var u=0,m=0;y.forEach(function(a,t){a[1]>=l&&(u=a[0],m=a[1])})}}else if(s.is(".kwota")){rata(l,f,r,i,n,o)}else if(s.is(".okres")){d+=1===l?" rok":l<5?" lata":" lat",f=l,v();rata(t,l,r,i,n,o)}})}),e.internal&&(pieChartOptions.colors[0]="#2AB478",pieChartOptions.plotOptions.series.animation=!1);var p=(c+s)/(t+c+s)*360,_=$(window).width()>480?80:50,z=[{data:[{y:100,color:"#eee"}],dataLabels:{enabled:!1},size:2*_},{name:"Credit",data:[{name:"wnioskowana kwota kredytu",y:t,color:"#62b14a"}],size:1.5*_,innerSize:_,startAngle:p,endAngle:360}],x=1.5*_,A=[{name:"odsetki",y:parseInt(c),color:"#f8d635"}];s>0&&(z.push({name:"Cost",data:[{name:"całkowity koszt kredytu",y:c+s,color:"#5e86b5"}],size:_,innerSize:.75*_,startAngle:0,endAngle:p,dataLabels:{distance:35}}),x=1.7*_,A.push({name:"prowizja",y:parseInt(s),color:"#808184"})),z.push({name:"Interest",data:A,size:x,innerSize:_,startAngle:0,endAngle:p}),$(".calc-chart").highcharts({chart:{type:"pie",spacing:0},title:{text:""},credits:{enabled:!1},plotOptions:{pie:{shadow:!1,center:["50%","50%"],borderWidth:0,enableMouseTracking:!1,dataLabels:{softConnector:!1,connectorColor:"#808184",formatter:function(){return'<span style="color: '+this.color+'; font-family: Ubuntu, sans-serif;">'+formatPrice(this.y)+" zł "+this.point.name+"</span>"},distance:5,style:{width:$(window).width()>480?"100px":"60px",fontWeight:"normal",fontSize:$(window).width()>480?"13px":"11px"}}}},tooltip:{enabled:!1},series:z}),u=$(".calc-chart").highcharts(),e.offer_id&&$('[name="id"]').prop("disabled",!1).val(e.offer_id),e.cena&&$('[name="cena"], [name="value"]').prop("disabled",!1).val(e.cena),e.report_id&&$('[name="report_id"]').prop("disabled",!1).val(e.report_id),$("body").addClass("init")}),e.internal&&($("body").addClass("internal"),"2"===e.internal&&$("body").addClass("internal-2")),e.submit_btn&&$("body").addClass("has-submit-button"),"true"==e.listing?($('[name="utm_content"]').val("listing"),$(".logo").attr("href","/?utm_campaign=Widgety&utm_source=otodom.pl&utm_medium=widget-kredytowy&utm_content=logo-listing")):$(".logo-small").attr("href","/?utm_campaign=Widgety&utm_source=otodom.pl&utm_medium=widget-kredytowy&utm_content=logo-adpage")});